## 常见问题



### 1. java（包括 springboot ）读取resources下文件方式

https://www.cnblogs.com/whalesea/p/11677657.html

#### 首先查看 pom.xml 配置资源路径

```xml
<resource>
    <directory>src/main/resources</directory>
    <includes>
        <include>**/*</include>
    </includes>
    <filtering>true</filtering>
</resource>
```

#### 1.1 使用项目内路径读取，该路径只在开发工具中显示

> 类似：`src/main/resources/resource.properties`。只能在开发工具中使用，部署之后无法读取。（**不通用**）

```java
File file = new File("src/main/resources/resource.properties");
```

#### 1.2 `org.springframework.util.ResourceUtils`

> **在`linux`环境中无法读取。（不通用）**
>
> `jar`包找不到路径

```java
File file = ResourceUtils.getFile("classpath:resource.properties");
FileInputStream fis = new FileInputStream(file);
```

#### 1.3 `org.springframework.core.io.ClassPathResource`

> **各种环境都能读取。（通用）**

```java
Resource resource = new ClassPathResource("resource.properties");
InputStream is = resource.getInputStream();

FileUtils.copyInputStreamToFile();
```

#### 1.4 注解 + `org.springframework.core.io.ResourceLoader`

> **结合spring注解，使用`org.springframework.core.io.ResourceLoader`;类的注解。（通用）**

```java
@Autowired
ResourceLoader resourceLoader;

@Test
public void testReaderFile() throws IOException {
    Resource resource = resourceLoader.getResource("classpath:resource.properties");
    InputStream is = resource.getInputStream();
    InputStreamReader isr = new InputStreamReader(is);
    BufferedReader br = new BufferedReader(isr);
    String data = null;
    while((data = br.readLine()) != null) {
        System.out.println(data);
    }

    br.close();
    isr.close();
    is.close();
}
```

```java
@Autowired
ResourceLoader resourceLoader;

Resource resource1 = resourceLoader.getResource("classpath:static/excel/1.xlsx");
File f4 = resource1.getFile();
```

不使用注解方式

```java
// 获取资源
ResourceLoader resourceLoader = new DefaultResourceLoader();
Resource resource = resourceLoader.getResource("classpath:static/excel/1.xlsx");
InputStream fs = resource.getInputStream();
```

### 2. 自动装配为 null

调用时组件类也应使用`@AutoWired`

### 3. @JsonFormat 时分秒为00

https://www.pianshen.com/article/7738324204/

> java.sql.date 没有时分秒

```java
import java.util.Date;

// …

@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss", timezone = "GMT+8")
private Date startTime;
```

## 常用

### 1. SpringBoot 定时任务

> 主要有三种方式

[玩转SpringBoot之定时任务详解 - 淼淼之森 - 博客园 (cnblogs.com)](https://www.cnblogs.com/mmzs/p/10161936.html)

#### 1.1 常用注解方式

```java
/**
 * @author zhanghua
 * @date 2021/8/11 17:11
 * @description
 */
@EnableScheduling
@Component
public class ScheduledTask {
    private final ClimateService climateService;

    private final Logger logger = LoggerFactory.getLogger(ScheduledTask.class);

    @Autowired
    public ScheduledTask(ClimateService climateService) {
        this.climateService = climateService;
    }

    /**
     * 每天1点7点执行一次
     */
    @Scheduled(cron = "0 0 1,7 * * ?")
    private void getWeatherTask() {
        logger.info("=========> 开始天气数据入库");

        SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
        LinkedHashMap<String, LinkedHashMap<String, Object>> multiIndexWeatherInfo = null;
        try {
            // 苏州 id 58349
            multiIndexWeatherInfo = WeatherUtil.getMultiIndexWeatherInfo("58349");
        } catch (IOException | JSONException e) {
            e.printStackTrace();
            logger.error("=========> 天气数据获取异常!!!!!!");
        }
        for (Map.Entry<String, LinkedHashMap<String, Object>> e : Objects.requireNonNull(multiIndexWeatherInfo).entrySet()) {
            String key = e.getKey();
            Date parse = null;
            try {
                parse = sdf.parse(key);
            } catch (ParseException parseException) {
                parseException.printStackTrace();
            }
            LinkedHashMap<String, Object> value = e.getValue();
            String info = (String) value.get("info");
            String direct = (String) value.get("direct");
            String power = (String) value.get("power");
            Double minTemp = (Double) value.get("minTemp");
            Double maxTemp = (Double) value.get("maxTemp");

            WeatherEntity weatherEntity = new WeatherEntity(null, parse, info, direct, power, minTemp, maxTemp);
            climateService.saveOneWeather(weatherEntity);
        }

        logger.info("=========> 结束天气数据入库");
    }
}
```

